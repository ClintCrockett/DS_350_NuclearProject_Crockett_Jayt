---
title: "ballgame"
format: html
---


```{r}
pacman::p_load(Lahman, priceR, ggplot2, pander, tidyverse)
```

```{r warning=FALSE, message=FALSE}
# data(package = "Lahman")

baseball <- CollegePlaying %>%
  left_join(Schools, by = "schoolID") %>% 
  left_join(
    People %>% 
      select(playerID, nameFirst, nameLast), by = "playerID") %>% 
  left_join(Salaries, by = "playerID")

ajdusted_baseball <- baseball %>%
  filter(state == "UT") %>% 
  mutate(
    salary_2021 = adjust_for_inflation(
      price = salary,
      from_date = yearID.y,
      country = "US",
      to_date = 2021
    )
  )
utah_players <- ajdusted_baseball %>%
  left_join(Batting %>% group_by(playerID) %>% 
              summarize(batting_total = sum(H, na.rm = TRUE)), by = "playerID") %>%
  left_join(Pitching %>% group_by(playerID) %>% 
              summarize(pitching_total = sum(SO, na.rm = TRUE)), by = "playerID") %>%
  left_join(Fielding %>% group_by(playerID) %>% 
              summarize(fielding_total = sum(PO + A, na.rm = TRUE)), by = "playerID")
```


```{r}
school_stats <- utah_players %>%
  group_by(name_full) %>%
  summarize(
    batting = mean(batting_total, na.rm = TRUE),
    pitching = mean(pitching_total, na.rm = TRUE),
    fielding = mean(fielding_total, na.rm = TRUE)
  ) %>%
  pivot_longer(cols = c(batting, pitching, fielding),
               names_to = "stat",
               values_to = "value")

```


```{r warning=FALSE}
ggplot(school_stats, aes(x = value, y = name_full, fill = stat)) +
  geom_col(position = "stack") +
  coord_flip() +
  labs(
    title = "Overall Batting, Pitching, and Fielding Strength by Utah College",
    x = "College",
    y = "Total Performance",
    fill = "Stat Type"
  ) +
  scale_fill_manual(values = c(
    batting = "#2A6F97",
    pitching = "#a2559c",
    fielding = "#e56e5a"
  )) +
  theme(
    axis.text.x = element_text(angle = 30, hjust = 1)
  )

```

### Interpretation

When I looked at the average batting, pitching, and fielding stats for each Utah school, BYU clearly stood out. Even when you average the performance per player (so BYU isn’t getting credit just for having more MLB guys), the BYU players still come out ahead in basically every category. Some of the other schools have a few solid players, but overall BYU is producing the most well-rounded MLB athletes. It’s actually pretty cool to see how consistent that pattern is across all three stats.

```{r message=FALSE}
bubble_data <- utah_players %>%
  filter(!is.na(salary_2021), salary_2021 > 0) %>%     # keep players with salary data
  mutate(
    total_performance = batting_total + pitching_total + fielding_total
  ) %>%
  group_by(playerID, name_full) %>%                      # one row per player
  summarize(
    avg_total_perf = mean(total_performance, na.rm = TRUE),
    avg_salary_2021 = mean(salary_2021, na.rm = TRUE)
  )
```

```{r warning=FALSE}
school_colors <- c(
  "Brigham Young University" = "#022e59",   # BYU blue
  "College of Eastern Utah" = "#DAA520",
  "Dixie State College of Utah" = "#228B22",
  "Salt Lake Community College" = "#38aabb",
  "Snow College" = "#87CEEB",
  "Southern Utah University" = "#e56e5a",
  "University of Utah" = "#883039",
  "Utah Valley State University" = "#a2559c"
)

ggplot(bubble_data, aes(
  x = name_full,
  y = avg_total_perf,
  size = avg_salary_2021,
  color = name_full
)) +
  geom_point(alpha = 0.65) +
  scale_size_continuous(labels = scales::dollar) +
  labs(
    title = "MLB Player Performance vs Salary by Utah College",
    subtitle = "Bubble size represents average career salary (2021 dollars)",
    x = "College",
    y = "Average MLB Player Performance\n(Batting + Pitching + Fielding)",
    size = "Avg Salary (2021 USD)",
    color = "College"
  ) + scale_color_manual(values = school_colors) +
  coord_flip() +
  theme(
    axis.text.y = element_text(angle = 30, hjust = 1)
  )

```

The bubble chart tells a similar story but from a different angle. Schools with higher-performing players also tend to have higher average salaries, and BYU players are again clustered toward the top with some of the bigger salary bubbles. A lot of the smaller schools barely register because they’ve only had one or two MLB players, and those players didn’t stick around long. BYU not only sends more players to the pros, but their players typically perform better and end up earning more. So overall, both graphs point to the same conclusion, BYU is easily the strongest, MLB pipeline out of all the Utah colleges.

